# PicProcess 

数字图像处理大作业

## 界面和UI设计

整体界面包括菜单栏、左侧的列表栏和右侧的显示窗口。

菜单栏： 
+ 所有可操作的图像变换均在菜单栏内
+ 文件选项包括：打开、关闭、保存文件。

列表栏： 

+ 列表栏包含两个列表：打开图像和处理图像。 二者的区别是： **对`打开图像`操作会创建一个`处理图像`的副本，只在该副本上操作，对原图像无影响； 对`处理图像`操作是 in-place 操作**。 
+ 外部打开的图像默认为`打开图像`， `处理图像`可以通过保存变为`打开图像`。 更方便的做法是用两个列表之间的箭头。
+ 列表栏内的图像可用 `ctrl` + 左键 或者 拖动左键多选，一次性关闭保存。

显示窗口：

+ 双击列表栏中的选项可以在显示窗口中显示该图像。 
+ **大部分图像操作是对当前显示窗口显示的图像进行**，除了`算数运算`，`项数重构`。 

## 设计

指定的需要实现的操作我大概分成了这么几类：

+ 算数运算
+ 几何变换
+ 非几何变换
+ FFT变换
+ 滤波处理
+ 其他综合应用

### 算数运算

包含四则运算和四种逻辑运算。 在点开算数运算选项，会跳出对话框选择左右操作数和运算符号。 

为了方便处理，增加了灰度化、二值化两个操作，选项中的求反操作和算数运算中的求反是一样的，只是方便调用增加了此选项。

实现细节：

+ 对超出[0, 255]的像素是直接 clip 处理的，所以会出现非常亮和非常暗的区域。

### 几何变换

包括： 平移、旋转、缩放、镜像。

细节：

+ 当出现未定义的区域（例如平移、缩小之后原位置未定义的区域），自动补0.
+ 因为显示的时候会直接丢弃掉显示区域以外的像素，所以旋转可能会丢失掉边角的像素（**再次旋转这部分像素已经丢弃了所以没有显示**）。

### 非几何变换

包括：

+ 指数级的灰度变换： 需要输入[0.01,10]之间的一个小数
+ 直方图均衡化变换： 直方图均衡化现在暂时仅能对灰度图处理，对RGB图处理结果也还是灰度图。

### FFT变换

+ FFT 正变换： 包括：(1) 两个一维FFT作二维FFT； (2) 动态值域压缩； (3) 中心平移。
+ FFT 反变换： 可以对得到的频域的数据进行反FFT变换，但由于显示的原因，本软件不单独作FFT反变换（见下面的实现细节）。

测试数据： 可以使用 `test_images/` 文件夹下的图像。


实现细节：

+ 对RGB图像，**我直接选取的第一个分量（也就是R分量）做的FFT**，所以和灰度图恢复出来的图像有点差别。
+ 因为底层是使用的基2的蝶式计算，所以**对边长非二次幂的图像，我是将图像补零加到二次幂大小**，得到的FFT图像也是完整的二次幂大小，但是**显示的原因，只截取了该FFT图像的上半部分**（和原图像大小相同），所以**显示的时候看起来FFT图像中心并不是显示的中心**。
+ 由于**显示的是幅值图，并没办法直接对幅值图作反FFT变换，所以暂时不能单独作反FFT变换**。为了提供反FFT变换效果，加入了一个`FFT变换再反FFT变换`的选项，是连续作FFT和反FFT，得到的图像是原来图像的R通道图像（由于上面的原因）。另外该选项对边长非二次幂的图像也可以。
+ **FFT的计算可能运行缓慢**。
+ 中心平移的选项没有提供，但是可以参见函数，有实现。
+ 动态值域压缩是默认提供的，没有动态值域压缩，几乎不能显示幅值图。

### 滤波处理

包含： (1) 均值滤波； (2) 高斯滤波； (3) 中值滤波；

三种滤波均可设定窗口的大小： [3,5,7]

实现细节：

+ 因为实现比较简单，就是按照公式循环，所以效率比较差，滤波窗口越大，需要时间越多，特别是中值滤波的效率比较低下。。。需要等待较长时间。

### 高级应用

包含： 

+ 边缘检测： 包括roberts, prewitt, sobel, laplace 四种算子。
+ K均值像素聚类： 可以设定目标类数量，可选 [2,..,10]
+ 边界项数重构：
+ Laplace锐化：

实现细节：

+ 边缘检测： 实现也比较简单，效率偏低。
+ K均值像素聚类的效率和 k, 图像大小有关，所以有时候也会比较慢，实现的函数中还有多种可选的参数，没显示设定。一般迭代在 30 次以内可以收敛到 0.01 的误差变动。 初始化方法选取的是按照像素区域均匀的初始化。
+ 边界项数重构： 因为没办法直接从图像获得边界点的信息，所以边界项数重构暂时只是一个例子的形式呈现，默认是一个64点的正方形边界。 `显示原目标边界` 选项可以直接显示该原始边界，`边界傅里叶描述子项数重构`选项可以选择目标的重构的项数。 该重构中的FFT我直接使用的 DFT 公式，对点数是否是二次幂大小无要求。
+ 用其他边缘检测算子和加法运算可以得到其他算子的锐化效果。

### TODO-List

- [x] Laplace 锐化
- [x] 切换的按钮
- [x] 进度条显示滤波的进展。
